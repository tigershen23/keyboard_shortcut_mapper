- ActionBar
- AppCombobox
- Key
- Keyboard


- KeyPopover
- LayerIndicator
- LayerContext
- MappingContext

### SYSTEM / TASK

You are cleaning up AI-generated “slop” and vibe-coding residue in a TypeScript/React codebase.

### TARGET

Clean up code under: <TARGET_PATH>

### GOAL

Make a reviewable diff that:

- preserves behavior and public APIs
- reduces maintenance burden
- removes “AI slop” patterns and vibe-coding giveaways
- improves type-safety and React correctness, if either are applicable
- keeps the code consistent with local repo conventions

### NON-NEGOTIABLE CONSTRAINTS

- Only edit files under <TARGET_PATH>.
- Do NOT introduce new third-party dependencies without permission. Do not change lockfiles.
- Do NOT change global configuration unless absolutely required; prefer module-level mechanisms.
- Avoid large rewrites and drive-by formatting. Only reformat lines you touch unless repo tooling forces more.
- Preserve runtime behavior unless fixing an obvious bug

### WORKFLOW (FOLLOW IN ORDER)

1. Slop audit (produce a short plan before editing): Scan <TARGET_PATH> and think about findings that fall under the categories below as well as the smallest possible fix for each.

2. Apply fixes iteratively: Make changes in small, coherent chunks

3. Final report: Provide a summary of key improvements (bullets) and files changed + one-line rationale each.

### SLOP / VIBE-CODING CHECKLIST (ENFORCE THIS)

A) Codebase-ignorant reimplementation (vibe coding giveaway)

- Before adding utilities, search for existing equivalents in-repo and reuse them.
- Do NOT re-implement fetching/caching/validation/auth patterns if the repo already has a standard.
- Do NOT introduce a new paradigm (e.g., classes) if the codebase is functional.

B) Boilerplate inflation / pointless indirection

- Inline pass-through wrappers and delete unused abstractions.
- Remove unused options/parameters, dead branches, and scaffolding.
- Prefer fewer concepts and fewer files unless local conventions require otherwise.

C) Readability drift

- Match adjacent-file conventions (naming, exports, module structure).
- Replace generic names with domain-meaningful names.
- Keep changes minimal and focused.

D) Debug residue and dead code (vibe coding giveaway)

- Remove console logs and temporary debug code.
- Delete unused files/exports left behind by prior iterations.

E) Over-broad blast radius (vibe coding giveaway)

- If a fix touches “too many” files, refactor to reduce scope or justify the blast radius in the report.

F) TypeScript slop

- Eliminate `any`, `as unknown as`, `@ts-ignore`, and broad eslint disables in touched code.
- Narrow `unknown` safely at boundaries; keep internal types sound.
- Prefer simple explicit types over clever generics.

G) React slop

- Remove unnecessary useEffect (especially derived state / internal data flow).
- Fix stale closure/deps issues.
- Avoid gratuitous useMemo/useCallback.
- Ensure async UI has loading + error states; remove non-functional UI affordances.

H) Error handling

- No blanket try/catch. Catch only to recover or add context. Never swallow.
- Normalize error handling to existing repo patterns.

I) Comments

- Default: delete comments. Keep only comments that add information the code cannot:
  1. WHY: rationale, tradeoffs, intent (“we do X because Y”)
  2. CONSTRAINTS: invariants, pre/post conditions, assumptions, performance or UX constraints
  3. GOTCHAS: non-obvious edge cases, ordering requirements, footguns, dependency quirks
  4. EXTERNAL CONTRACTS: references to specs, API quirks, protocol formats, backwards-compat constraints

- Remove:
  - “narration” comments that restate the next line (e.g., “set loading to true”)
  - tutorial / blog-style explanations
  - autogenerated headers and boilerplate docblocks
  - TODO/FIXME unless (a) it’s actionable, (b) has an owner/issue link, and (c) explains impact

- Rewrite remaining comments to be:
  - short (1–3 lines), concrete, and specific
  - phrased as constraints/rationale, not step-by-step narration
  - aligned with repo tone (no overly formal / corporate / “As an AI…” style)

- Prefer naming over comments:
  - If a comment is explaining _what_ a variable/function is, rename it instead and delete the comment.

- If a comment describes behavior that is no longer true, update it or delete it.

J) Tests

- Delete or fix tests with no asserts or weak asserts.
- Add edge/error cases for touched logic.
- Avoid flakiness; make async deterministic.

DECISION RULE
