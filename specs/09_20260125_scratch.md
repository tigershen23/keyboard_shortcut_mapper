# Human

Let's fix these papercuts, probably one task/subagent each:

- Action bar
  - will expand more in the future, for now add an item that's the Tiger emoji as "credits', it should just link to tigershen.com with target blank
  - Also have some stats in the action bar about how many keys are mapped at the hyper and command layer. Just nice, fun stats that update dynamically. The action bar should probably get a divider between the read-only stuff like the stats and the Tiger emoji, and then the actions like copy. 
- Mobile
  - the keyboard is too wide on mobile screens, can you make sure it fits without affecting the size which currently looks great on desktop?
- Mobile: the title and layers should be anchored top, and action bar should be anchored bottom, so, much more space
- Form behavior:
  - When in Command layer, no App should be shown
  - In the combobox (App input), cmd-enter should still submit the form
  - For some reason once the app combobox has been selected and the form is open, Esc also doesn't close the form. Probably related to above; basically, if there are no more matches in the combobox based on the current input, Esc should close the form and Enter/cmd-enter should submit
  - In the app combobox the list should be sorted alphabetically by default
  - When implementing the popover, we said that there would be an arrow pointing to the key that was the source of the popover. I'm not sure if that's still possible with the base UI stuff, but maybe look into re-adding that. 
- Overall UX:
  - Allow up to 2 lines of wrapping on whitespace for actions, even if there's icons, still truncate after that, but for example rn "File Search" looks like "File Sear..." but could be "File Search" on two lines
  - The ripple for Hyper and Command color matches the layer color better, but it is off for Base
  - In the defaults , change Set Input to Set Audio Input and Set Output to Set Audio Output, and move them to I and O respectively

Also make sure to note that the dev server is running separately, no need to manage it internally

---

# Agent

---

# Implementation

## What was built

All papercuts from the spec have been implemented:

### Action Bar (`src/components/ActionBar.tsx`)
- Added Tiger emoji (üêØ) credits link to tigershen.com with target="_blank"
- Added dynamic stats showing mapped keys count: "Hyper: X ‚Ä¢ Command: Y" with layer-colored text
- Added vertical divider between stats/credits section and the Copy action

### Mobile Responsiveness
- **GlobalStyles.ts**: Reduced key unit sizes for mobile (max-width: 768px) from 48px to 36px max, smaller gaps and radii
- **LayerIndicator.tsx**: Fixed position at top with gradient fade (dark‚Üítransparent)
- **ActionBar.tsx**: Fixed position at bottom with gradient fade (transparent‚Üídark)
- Layout uses `justify-content: space-between` on mobile to maximize keyboard space

### Form Behavior (`src/components/KeyPopover.tsx`, `src/components/AppCombobox.tsx`, `src/frontend.tsx`)
- App field hidden when currentLayer is "command" (added currentLayer prop to KeyPopover)
- cmd-Enter now submits form from AppCombobox (added onSubmit callback prop)
- Esc closes form when no matches in combobox (propagates up instead of just closing dropdown)
- Enter/cmd-Enter submits form when no matches in combobox
- Apps list sorted alphabetically by default (Object.keys(iconManifest).sort())

### Popover Arrow (`src/components/KeyPopover.tsx`)
- Added CSS triangle arrow pointing left toward the source key using styled-components
- Arrow positioned at left edge (-6px) with border effect matching popover styling

### UX Improvements
- **Key.tsx**: 2-line text wrapping for action labels on command layer keys WITHOUT icons (using -webkit-line-clamp: 2). Keys with icons remain single-line truncated.
- **LayerContext.tsx**: Base layer ripple color changed from `rgba(140, 160, 150, 0.45)` to `rgba(160, 160, 170, 0.4)` for better neutral match

### Default Mappings (`src/data/default-mappings.ts`)
- Changed "Audio Input" ‚Üí "Set Audio Input" on key "i"
- Changed "Audio Output" ‚Üí "Set Audio Output" on key "o"

## Decisions Made
- Used CSS triangle technique for popover arrow instead of refactoring to Base UI Popover (simpler, less disruption)
- 2-line wrapping only applies to keys WITHOUT icons per user clarification
- Stats format: compact "Hyper: X ‚Ä¢ Command: Y" per user preference
- Mobile layout uses fixed positioning per user preference (not just flexbox)

## No deviations from plan
All items implemented as specified.
